jobs:
  # 1. THE WARM UP: Continuous Integration
  ci:
    name: "CI - The Warm Up"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
      - name: Run Tests
        run: echo "Testing... Landing the kickflip..."
        # Your test scripts go here

  # 2. THE AUDIT: Security Scanning (Crucial for Business Scale)
  security:
    needs: [ci]
    name: "Security Audit"
    runs-on: ubuntu-latest
    steps:
      - name: Scan Dependencies
        run: echo "Checking for vulnerabilities (pebbles on the runway)..."

  # 3. THE DROP: Production Deployment
  deploy:
    name: "Deploy - The Drop"
    needs: [ci, security] # Wait for CI AND Security checks
    runs-on: ubuntu-latest
    
    # ENVIRONMENT PROTECTION: This connects to GitHub Settings.
    # It allows us to require manual approval from a Senior Dev (me or you) 
    # before code actually hits the live servers.
    environment: 
      name: production
      url: https://skatehubba.com

    # CONCURRENCY CONTROL:
    # This prevents two deploys from happening at the same time and crashing the server.
    # If a new deploy starts, we don't cancel the one in progress (safety first).
    concurrency: 
      group: production-deploy
      cancel-in-progress: false 

    steps:
      - uses: actions/checkout@v4
      
      - name: Deploy to Cloud
        run: |
          echo "Deploying to production..."
          # Insert AWS/Vercel/DigitalOcean logic here

      - name: Smoke Test (Health Check)
        run: |
          # We verify the site is actually up. If this fails, the job fails.
          curl --fail https://skatehubba.com/api/health || exit 1

      - name: Notify Team (Slack/Discord)
        if: always() # Run this even if the deploy bails
        run: |
          echo "Yo team, deploy finished with status: ${{ job.status }}"
